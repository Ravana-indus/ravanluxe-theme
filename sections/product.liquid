<div class="product-page-luxury">
  <div class="product-page-luxury__gallery">
    {% if product.images.size > 0 %}
      {%- comment -%} Desktop: 2x2 Grid {%- endcomment -%}
      <div class="product-gallery-desktop">
        {% for image in product.images limit: 4 %}
          <div class="product-gallery__image">
            {{ image | image_url: width: 1000 | image_tag: loading: 'lazy', alt: product.title }}
          </div>
        {% endfor %}
      </div>

      {%- comment -%} Mobile: Swipeable Carousel {%- endcomment -%}
      <div class="product-gallery-mobile">
        <div class="mobile-carousel" data-mobile-carousel>
          {% for image in product.images %}
            <div class="mobile-carousel__slide">
              {{ image | image_url: width: 800 | image_tag: loading: 'lazy', alt: product.title }}
            </div>
          {% endfor %}
        </div>
        <div class="mobile-carousel__dots" data-carousel-dots>
          {% for image in product.images %}
            <button
              class="carousel-dot {% if forloop.first %}active{% endif %}"
              data-dot-index="{{ forloop.index0 }}"
              aria-label="Go to slide {{ forloop.index }}"
            ></button>
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </div>

  <div class="product-page-luxury__sidebar">
    <div class="product-page-luxury__sidebar-content">
      <div class="product-header">
        <h1 class="product-header__title">{{ product.title }}</h1>
        <div class="product-header__price" data-product-price>
          {{ product.selected_or_first_available_variant.price | money }}
        </div>
      </div>

      {% form 'product', product, id: 'product-form-luxury', data-product-form: '' %}
        <input
          type="hidden"
          name="id"
          value="{{ product.selected_or_first_available_variant.id }}"
          data-variant-id
        >

        {% unless product.has_only_default_variant %}
          <div class="product-options">
            {% for option in product.options_with_values %}
              <div class="product-option">
                <label class="product-option__label">{{ option.name }}</label>
                <div class="product-option__buttons">
                  {% for value in option.values %}
                    <button
                      type="button"
                      class="option-button {% if option.selected_value == value %}active{% endif %}"
                      data-option-button
                      data-option-position="{{ option.position }}"
                      data-option-value="{{ value | escape }}"
                    >
                      {{ value }}
                    </button>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}
          </div>
        {% endunless %}

        <div class="product-quantity">
          <label class="product-quantity__label">Quantity</label>
          <div class="quantity-selector">
            <button type="button" class="quantity-button" data-quantity-decrease aria-label="Decrease quantity">âˆ’</button>
            <input
              type="number"
              name="quantity"
              value="1"
              min="1"
              class="quantity-input"
              data-quantity-input
            >
            <button type="button" class="quantity-button" data-quantity-increase aria-label="Increase quantity">+</button>
          </div>
        </div>

        <button
          type="submit"
          class="product-submit"
          data-add-to-cart
          {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %}
        >
          <span data-button-text>
            {% if product.selected_or_first_available_variant.available %}
              Add to Basket
            {% else %}
              Sold Out
            {% endif %}
          </span>
        </button>
      {% endform %}

      {% if product.description != blank %}
        <div class="product-accordion">
          <details class="accordion-item" open>
            <summary class="accordion-summary">Description</summary>
            <div class="accordion-content">{{ product.description }}</div>
          </details>

          <details class="accordion-item">
            <summary class="accordion-summary">Details & Care</summary>
            <div class="accordion-content">
              <p>Crafted with meticulous attention to detail, celebrating Tamil heritage through contemporary luxury design.</p>
              <ul>
                <li>Premium materials</li>
                <li>Handcrafted quality</li>
                <li>Made in India</li>
                <li>Professional dry clean recommended</li>
              </ul>
            </div>
          </details>

          <details class="accordion-item">
            <summary class="accordion-summary">Shipping & Returns</summary>
            <div class="accordion-content">
              <p>Free worldwide shipping on orders over $200. Returns accepted within 14 days.</p>
            </div>
          </details>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script type="application/json" data-product-json>
  {{ product | json }}
</script>

{% stylesheet %}
  .product-page-luxury {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 2rem;
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 2rem var(--page-margin);
  }

  /* Gallery */
  .product-page-luxury__gallery {
    position: relative;
  }

  .product-gallery-desktop {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
  }

  .product-gallery__image {
    aspect-ratio: 3 / 4;
    background-color: var(--color-secondary-background);
    overflow: hidden;
  }

  .product-gallery__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-gallery-mobile {
    display: none;
  }

  .mobile-carousel {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }

  .mobile-carousel::-webkit-scrollbar {
    display: none;
  }

  .mobile-carousel__slide {
    flex: 0 0 100%;
    scroll-snap-align: start;
  }

  .mobile-carousel__slide img {
    width: 100%;
    height: auto;
    display: block;
  }

  .mobile-carousel__dots {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem 0;
  }

  .carousel-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    border: 1px solid var(--color-foreground);
    background: transparent;
    cursor: pointer;
    padding: 0;
    transition: background 0.3s ease;
  }

  .carousel-dot.active {
    background-color: var(--color-foreground);
  }

  /* Sidebar */
  .product-page-luxury__sidebar {
    position: sticky;
    top: 100px;
    height: fit-content;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 2rem;
  }

  .product-page-luxury__sidebar-content {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  /* Header */
  .product-header {
    padding-bottom: 2rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .product-header__title {
    font-size: 1.5rem;
    font-weight: 400;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    margin-bottom: 1rem;
    color: var(--color-foreground);
  }

  .product-header__price {
    font-size: 1.125rem;
    font-weight: 500;
    letter-spacing: 0.02em;
    color: var(--color-foreground);
  }

  /* Options */
  .product-options {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .product-option__label {
    display: block;
    font-size: 0.8125rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    margin-bottom: 0.75rem;
    color: var(--color-foreground);
  }

  .product-option__buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .option-button {
    padding: 0.75rem 1.5rem;
    border: 1px solid var(--color-foreground);
    background: var(--color-background);
    color: var(--color-foreground);
    font-size: 0.875rem;
    letter-spacing: 0.05em;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 60px;
    font-family: inherit;
  }

  .option-button:hover {
    opacity: 0.7;
  }

  .option-button.active {
    background-color: var(--color-foreground);
    color: var(--color-background);
  }

  .option-button:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  /* Quantity */
  .product-quantity__label {
    display: block;
    font-size: 0.8125rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    margin-bottom: 0.75rem;
    color: var(--color-foreground);
  }

  .quantity-selector {
    display: flex;
    border: 1px solid var(--color-foreground);
    width: fit-content;
  }

  .quantity-button {
    width: 40px;
    height: 40px;
    border: none;
    background: var(--color-background);
    color: var(--color-foreground);
    cursor: pointer;
    font-size: 1.125rem;
    transition: background 0.3s ease;
    font-family: inherit;
  }

  .quantity-button:hover {
    background-color: var(--color-secondary-background);
  }

  .quantity-input {
    width: 60px;
    height: 40px;
    border: none;
    border-left: 1px solid var(--color-foreground);
    border-right: 1px solid var(--color-foreground);
    text-align: center;
    font-size: 0.875rem;
    font-family: inherit;
    color: var(--color-foreground);
  }

  .quantity-input:focus {
    outline: none;
  }

  /* Submit Button */
  .product-submit {
    width: 100%;
    padding: 1.125rem;
    background-color: var(--color-foreground);
    color: var(--color-background);
    border: 1px solid var(--color-foreground);
    font-size: 0.875rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: inherit;
  }

  .product-submit:hover:not(:disabled) {
    background-color: var(--color-background);
    color: var(--color-foreground);
  }

  .product-submit:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Accordion */
  .product-accordion {
    display: flex;
    flex-direction: column;
  }

  .accordion-item {
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .accordion-summary {
    padding: 1.5rem 0;
    font-size: 0.875rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    cursor: pointer;
    list-style: none;
    color: var(--color-foreground);
  }

  .accordion-summary::-webkit-details-marker {
    display: none;
  }

  .accordion-content {
    padding-bottom: 1.5rem;
    font-size: 0.875rem;
    line-height: 1.8;
    color: var(--color-foreground);
  }

  .accordion-content ul {
    list-style: disc;
    padding-left: 1.5rem;
    margin-top: 0.5rem;
  }

  .accordion-content li {
    margin-bottom: 0.25rem;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .product-page-luxury {
      grid-template-columns: 1fr;
    }

    .product-gallery-desktop {
      display: none;
    }

    .product-gallery-mobile {
      display: block;
    }

    .product-page-luxury__sidebar {
      position: relative;
      top: 0;
      border-left: none;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      padding-left: 0;
      padding-top: 2rem;
    }
  }

  @media (max-width: 768px) {
    .product-page-luxury {
      padding: 1.5rem var(--page-margin);
    }

    .product-header__title {
      font-size: 1.25rem;
    }

    .option-button {
      padding: 0.625rem 1.25rem;
      font-size: 0.8125rem;
    }
  }
{% endstylesheet %}

{% javascript %}
(function() {
  // Wait for DOM to be fully loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  function init() {
    const productFormElement = document.querySelector('[data-product-form]');
    if (!productFormElement) return;

    // Parse product JSON
    const productJson = document.querySelector('[data-product-json]');
    if (!productJson) return;

    const product = JSON.parse(productJson.textContent);

    // Initialize components
    new VariantSelector(productFormElement, product);
    new QuantitySelector(productFormElement);
    new MobileCarousel();
  }

  // Variant Selector Class
  function VariantSelector(form, product) {
    this.form = form;
    this.product = product;
    this.variantData = product.variants;
    this.optionButtons = form.querySelectorAll('[data-option-button]');
    this.variantIdInput = form.querySelector('[data-variant-id]');
    this.priceElement = document.querySelector('[data-product-price]');
    this.addToCartButton = form.querySelector('[data-add-to-cart]');
    this.buttonText = form.querySelector('[data-button-text]');

    this.init();
  }

  VariantSelector.prototype.init = function() {
    const self = this;
    this.optionButtons.forEach(function(button) {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        self.onOptionClick(this);
      });
    });
  };

  VariantSelector.prototype.onOptionClick = function(button) {
    const position = button.getAttribute('data-option-position');
    const value = button.getAttribute('data-option-value');

    // Update active state
    const siblings = this.form.querySelectorAll('[data-option-position="' + position + '"]');
    siblings.forEach(function(btn) {
      btn.classList.remove('active');
    });
    button.classList.add('active');

    // Find matching variant
    this.updateVariant();
  };

  VariantSelector.prototype.updateVariant = function() {
    const selectedOptions = this.getSelectedOptions();
    const variant = this.findMatchingVariant(selectedOptions);

    if (variant) {
      this.variantIdInput.value = variant.id;
      this.updatePrice(variant.price);
      this.updateButton(variant.available);
    }
  };

  VariantSelector.prototype.getSelectedOptions = function() {
    const options = [];
    const activeButtons = this.form.querySelectorAll('[data-option-button].active');

    activeButtons.forEach(function(button) {
      const position = parseInt(button.getAttribute('data-option-position'));
      const value = button.getAttribute('data-option-value');
      options[position - 1] = value;
    });

    return options;
  };

  VariantSelector.prototype.findMatchingVariant = function(selectedOptions) {
    return this.variantData.find(function(variant) {
      return selectedOptions.every(function(option, index) {
        return variant.options[index] === option;
      });
    });
  };

  VariantSelector.prototype.updatePrice = function(price) {
    if (this.priceElement) {
      this.priceElement.textContent = this.formatMoney(price);
    }
  };

  VariantSelector.prototype.updateButton = function(available) {
    if (this.addToCartButton && this.buttonText) {
      this.addToCartButton.disabled = !available;
      this.buttonText.textContent = available ? 'Add to Basket' : 'Sold Out';
    }
  };

  VariantSelector.prototype.formatMoney = function(cents) {
    return '$' + (cents / 100).toFixed(2);
  };

  // Quantity Selector Class
  function QuantitySelector(form) {
    this.form = form;
    this.input = form.querySelector('[data-quantity-input]');
    this.decreaseButton = form.querySelector('[data-quantity-decrease]');
    this.increaseButton = form.querySelector('[data-quantity-increase]');

    if (this.input && this.decreaseButton && this.increaseButton) {
      this.init();
    }
  }

  QuantitySelector.prototype.init = function() {
    const self = this;

    this.decreaseButton.addEventListener('click', function(e) {
      e.preventDefault();
      self.decrease();
    });

    this.increaseButton.addEventListener('click', function(e) {
      e.preventDefault();
      self.increase();
    });

    this.input.addEventListener('change', function() {
      self.validate();
    });
  };

  QuantitySelector.prototype.decrease = function() {
    const currentValue = parseInt(this.input.value) || 1;
    if (currentValue > 1) {
      this.input.value = currentValue - 1;
    }
  };

  QuantitySelector.prototype.increase = function() {
    const currentValue = parseInt(this.input.value) || 1;
    this.input.value = currentValue + 1;
  };

  QuantitySelector.prototype.validate = function() {
    const value = parseInt(this.input.value) || 1;
    if (value < 1) {
      this.input.value = 1;
    }
  };

  // Mobile Carousel Class
  function MobileCarousel() {
    this.carousel = document.querySelector('[data-mobile-carousel]');
    this.dots = document.querySelectorAll('[data-dot-index]');

    if (this.carousel && this.dots.length > 0) {
      this.init();
    }
  }

  MobileCarousel.prototype.init = function() {
    const self = this;

    // Dot click handlers
    this.dots.forEach(function(dot) {
      dot.addEventListener('click', function() {
        const index = parseInt(this.getAttribute('data-dot-index'));
        self.scrollToSlide(index);
      });
    });

    // Scroll handler for updating dots
    let scrollTimeout;
    this.carousel.addEventListener('scroll', function() {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(function() {
        self.updateActiveDot();
      }, 100);
    });
  };

  MobileCarousel.prototype.scrollToSlide = function(index) {
    const slideWidth = this.carousel.offsetWidth;
    this.carousel.scrollTo({
      left: index * slideWidth,
      behavior: 'smooth'
    });
  };

  MobileCarousel.prototype.updateActiveDot = function() {
    const slideWidth = this.carousel.offsetWidth;
    const currentIndex = Math.round(this.carousel.scrollLeft / slideWidth);

    this.dots.forEach(function(dot, index) {
      if (index === currentIndex) {
        dot.classList.add('active');
      } else {
        dot.classList.remove('active');
      }
    });
  };
})();
{% endjavascript %}

{% schema %}
{
  "name": "Product Page",
  "settings": []
}
{% endschema %}